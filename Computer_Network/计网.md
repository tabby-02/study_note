# 第1章 计算机网络和因特网

## **1** 什么是因特网

### 1.1具体构成描述

1.计算设备(主机(终端系统),服务器)

2.通信链路(光纤、同轴电缆、无线电、卫星)

3.中转设备(路由器和交换机)

### 1.2 服务描述

分布式应用程序:在端系统上运行，彼此可以通信。

应用程序仅运行在终端系统上，不运行在网络核心的分组交换机中，因此**因特网**是**为应用程序提供服务**的基础设施。 

由终端系统提供应用程序编程接口(API) 

### 1.3 什么是协议

由某些设备的硬件或软件执行。

一个协议定义了在两个或多个通信实体之间交换的**报文格式和次序**，以及报文**发送**和/或**接收**一条报文或其他事件**所采取的动作**。

**协议三要素**：**语义，语法，时序**

## 2 网络边缘

### 网络划分为两大部分： 

**网络边缘**（资源子网） 

  外围部件、主机（客户、服务器）  网络应用
**网络核心**（通信子网） 

 **路由器** **通信链路** 网络的网络

### 2.1 接入网

接入网：将**端系统**连接到其**边缘路由器**的物理链路。

<img src="\Snipaste_2024-06-11_09-26-27.png" style="zoom:60%;" /> 

三种接入网

#### 1、家庭接入（DSL、电缆、FTTH、拨号和卫星）

<img src="\Snipaste_2024-06-11_09-44-38.png" style="zoom:60%;" /> 

##### (1).数字用户线(DSL)

使用已有的**电话线**传送信号

DSL采用<u>***频分复用技术***</u>(可以同时打电话和上网的原因)

##### (2).混合光纤同轴电缆(HFC)

**同轴电缆**和**光纤**混合接入

采用特殊的电缆调制解调器
划分为两个信道
共享广播媒体(**频分复用技术**)

##### (3).光纤到户技术(FTTH)

##### (4).卫星链路接入

#### 2、企业（和家庭）接入

<img src="\Snipaste_2024-06-11_09-44-48.png" style="zoom:60%;" /> 

#### 3、广域无线接入(移动接入)

### 2.2 物理媒体

#### 1、双绞铜线(如电话线)

两根绝缘的铜线螺旋形式扭合在一起。**减少对邻近双绞线的电气干扰**。

双绞线**电缆**：多对(4对)双绞线捆扎成一根电缆，并在外面覆盖上防护层

#### 2、 同轴电缆(电缆)

套在一起的两个同心铜导体。

 **内导体**传递**数据**。
 **外导体**用作地线及**屏蔽干扰**。

抗干扰能力强、数据率高。

#### 3、光纤

#### 4、 陆地无线电信道

无线LAN，WAP、3G、4G技术

#### 5、卫星无线电信道

## 3 网络核心

网络内部：连接端系统的**分组交换机**和**链路**形成的网状网络

数据如何通过网络传送：分组交换

### 3.1分组交换(不需要资源预留)

1.**不需要资源预留**；

2.按需使用资源，可能要排队等待：同时有其它分组发送。如，因特网。

定义：主机将应用层消息分割为若干**分组/小包(packets）**，通过每个**路由器逐跳**的转发分组，每个分组以链路的**最大传输速率传输**

#### 存储转发机制 

#### 两个关键的网络核心功能

**路由**(routing): 确定分组从源-目的主机的路径

**转发**(forwarding): 将分组从路由器的输入端口转到适当的路由器的输出端口（每个分组都会包含接收终端的IP地址，路由器根据IP地址在自己的<u>转发表</u>中查找这个IP地址对应的输出链路）

### 3.2 电路交换(预留端到端资源)

1.**预留端到端资源**

2.发送方以**恒定速率**向接收方传送数据。如，电话网络

定义：通信双方必须先建立一个**专用的连接**（电路），一直维持，直到通信结束。如，电话网络。

缺点：

1.**效率较低**：静默期（无数据传输）专用电路空闲，网络资源被浪费

2.创建端到端电路及预留端到端带宽的过程复杂

#### 频分多路复用FDM

按频率划分若干频段，**每个频段**专用于一个连接

<img src="\Snipaste_2024-06-11_10-29-58.png" style="zoom:60%;" /> 

#### 时分多路复用TDM

时间划分为固定区间的帧，每帧再划分为固定数量的时隙，**每个时隙**专用于一个连接

<img src="\Snipaste_2024-06-11_10-30-02.png" style="zoom:60%;" /> 

### 3.3 几种交换技术对比

<img src="\Snipaste_2024-06-11_10-34-27.png" style="zoom:60%;" /> 

### 3.4 网络的网络

终端系统通过**ISP**s(**因特网服务提供商**)与因特网相连，接入**服务提供商必须相互连接**，最终形成非常复杂的**网络的网络**—因特网

<img src="\Snipaste_2024-06-11_10-44-50.png" style="zoom:60%;" /> 

## 4分组交换网中的时延、丢包和吞吐量

### 4.1四种时延：**节点处理时延**、**排队时延**、**传输时延**和**传播时延**

**节点处理时延**d<sub>proc</sub>：检测比特错误，确定输出链路

**排队时延**：在一段时间内，分组到达链路速率超过了链路的传输速率，分组将排队，在输出链路上等待传输；

**传输时延**d<sub>trans</sub>：发送需要的时间， *L*: 分组长度bits，*R*: 带宽(传输速率)bps，传输时延= **L/R**

**传播时延**d<sub>prop</sub>：将分组从传输链路的一端传输到另一端，d：物理链路长，s：光在真空中传播速度(传播速率)，传播时延=**d/s**

**丢包**：排队时如果缓存溢出，则会出现丢包

丢失的分组可以由**前一个节点重传**，也可以由**源终端系统重传**，或根据**不需要重传**

<img src="\Snipaste_2024-06-11_10-38-24.png" style="zoom:60%;" /> 

**端到端时延**：发送**分组的长度**为**L**比特，将分组发送到接入链路的**传输速率**为**R**(bits/sec)，那么发送需要的时间为**L/R**，**端到端时延2L/R**

单个分组端到端时延(单个报文端到端时延)：d<sub>end-end</sub> =N(d<sub>proc</sub>+d<sub>trans</sub>+d<sub>prop</sub>)(N条链路，N-1个路由器)

多个分组连续发送端到段时延:d<sub>end-end</sub> =(N+n-1)(d<sub>trans</sub>+d<sub>proc</sub>)+Nd<sub>prop</sub>(N条链路，n个分组)

<img src="\Snipaste_2024-06-11_11-44-29.png" style="zoom:60%;" /> 

<img src="\IMG20240229160649.jpg" style="zoom:15%;" /> 

#### Traceroute的原理

• 从源地址发出一个**UDP探测包**到目的地址，并将**TTL设置为1**； 
• 到达路由器时，将**TTL减1**； 
• 当**TTL变为0时**，包被丢弃，路由器**向源地址发回**一个ICMP超时通知,内含发送IP包的源地址，IP包的所有内容及路由器的IP地址；
• 重复1～5，并**每次设置TTL加1**； 
• 直至目标地址收到探测数据包，并返回**端口不可达通知**

### 4.2吞吐量(Throughput)

吞吐量：在发送方和接收方之间**传输的比特数**（位/时间单位） (注意与带宽的区别-**发送方发送**分组的传输速率-**发送方和接收方之间**单位时间传输比特数)(单位都是bps)

即时吞吐量：在给定时间点的传输速率 

平均吞吐量：在较长时间段内的传输速率

## 5 协议层次及其服务模型

### 5.1 分层的体系结构

#### 1.网络协议为什么要进行分层？

 **使复杂系统简化**：将一个大而复杂系统划分为若干个明确、特定的部分，分别讨论研究。

 **易于维护、系统的更新**：某层功能变化，**不会影响系统其余部分**。

#### 2.分层的特点

 每个层次实现一个相对单一的服务

 每层自己执行一些动作来完成服务

 每层可以使用相邻下一层提供的服务

上层调用下层提供的服务，下层为上层提供服务

**服务定义**：各层通过其SAP向上层提供的一组功能

#### 3.TCP/IP协议栈

<img src="\Snipaste_2024-06-11_11-56-21.png" style="zoom:60%;" /> 

5.应用层：支持**网络应用**（FTP, SMTP, HTTP，DNS）

4.运输层：完成**端到端的数据传输**（TCP, UDP）

3.网络层：**数据报**从源地址到目的地址的**路由**（IP, routing protocols）

2.链路层：**相邻**网络元素间**数据传输**（Ethernet, 802.11 (WiFi), PPP）

1.物理层

**路由器**：实现**第一层到第三层**，能够实现IP协议；

**链路层交换机**：实现**第一层和第二层**，能够识别第二层地址，如以太网地址。

**主机**：实现**所有5个层次**

### 5.2 封装

源主机：由高层向低层逐层传递数据（封装）

<img src="\Snipaste_2024-06-11_12-10-36.png" style="zoom:100%;" /> 

目的主机：由低层向高层逐层传递（解封装）

如果报文很长，传输时，可先**分成多个报文段**，每个报文段在网络层再**分成多个数据报**。

## 6 面对攻击的网络

### 1.经因特网将有害程序放入你的计算机中

恶意代码：**病毒**，**蠕虫**

间谍软件

### 2.攻击服务器和基础设施

**Denial of Service (DoS):** 攻击者使资源(server/bandwidth)对于合法的流量不可用，通过使用虚假的流量来耗费资源

### 3.嗅探(sniff)分组

### 4.伪装成你信任的人

IP哄骗

# 第2章 应用层

## 1 应用层协议原理

### 1.1 网络应用程序体系结构

两种体系结构

#### 1.client-server(**C/S**, B/S)  

(1)服务器(server): 

 **保持开机**状态 **固定的IP地址** 可以采用具有扩展性的数据中心

(2)客户端(client):

 主动与服务器进行通信 可以间断性连接 可以采用动态IP地址 客户端进程之间**相互不通信**

#### 2.peer-to-peer (**P2P**)

服务器**不需要总是开机状态**，任意的终端系统之间**可以直接通信**，对等节点可以间歇性互连和<u>改变IP</u>地址（管理非常复杂）

### 1.2 进程通信

**不同主机**上的**进程通信**可以采取**消息交换**

#### 1.套接字(socket)

进程发送/接收消息给/从它的套接字-------------(类似门，进出都通过它)

#### 2.进程寻址

**标识符**(identifier)包括与进程运行主机关联的**IP地址**和**端口号**(port numbers).

**IP地址**:唯一标识<u>*主机*</u>  **端口号**：唯一标识<u>*进程*</u>

### 1.3 可供应用程序使用的运输服务

<img src="\Snipaste_2024-06-11_13-46-49.png" style="zoom:60%;" /> 

### 1.4 因特网提供的运输服务

**TCP服务**：*reliable transport*

**UDP服务**：*unreliable data transfer*

### 1.5 应用层协议

交换**消息的类型**(e.g., request, response)，消息**语法**，消息**语义**，**规则**(在什么时候以及如何发送&响应消息)

## 2 Web和HTTP(使用TCP,port:80)

HTTP: 超文本传输协议

**网页**可以包括多个对象

**对象**可以是 HTML file, JPEG image, Java applet, audio file,…

### 2.1 HTTP概况

**使用TCP**：客户端进程发起TCP连接请求(通过创建socket), port 80

HTTP是**无状态**的：服务器**不维护历史的客户请求信息**

### 2.2 HTTP 连接

<img src="\Snipaste_2024-06-11_17-45-14.png" style="zoom:60%;" /> 

**1.非持续HTTP连接**：通过TCP连接**最多发送一个对象**，然后关闭TCP连接

每个对象要求2个RTTs，1个RTT用于建立TCP连接，1个RTT用于HTTP请求，响应时间 = 2RTT+ file transmission time

非持续无并行：**N*2RTT**+N file transmission time)

非持续n并行：**(2RTT)+(N-1)/n*(2RTT)**+N file transmission time

HTML文件用时+其他对象用时

**2.持续HTTP连接**：多个对象可以基于一个TCP连接发送

非流水线方式：客户机只能在前一个响应接收到之后才能发出新的请求。

流水线方式：客户机可一个接一个连续产生请求

持续流水：1RTT+1RTT+1RTT+N file transmission time=**3RTT**+N file transmission time

TCP(1)+HTML(1)+其他对象(1)

持续非流水：**(1+N)RTT**+N file transmission time

TCP(1)+所有对象(N)

### 2.3 HTTP报文格式

#### 1.请求：方法+URL路径+协议版本

<img src="\Snipaste_2024-06-11_14-14-00.png" style="zoom:80%;" /> 

**HTTP/1.0**:  GET  POST  HEAD

**HTTP/1.1**:  GET, POST, HEAD  PUT  DELETE

**POST**：输入**通过(entity body)**上传到服务器

**GET**(URL方法)： 输入**通过**请求命令行的**URL字段**上传

**HEAD**：请求返回对象响应报文**首部**

**PUT**：将entity body中的**文件上传**到URL字段指定的位置

**DELETE**：**删除**URL字段中指定的**文件**

#### 2.响应：协议版本+状态码+短语

<img src="\Snipaste_2024-06-11_14-15-35.png" style="zoom:80%;" /> 

**200 OK**

**301 Moved Permanently (永久的重定向)**

**400 Bad Request**

**404 Not Found**

**505 HTTP Version Not Supported**

### 2.4 用户与服务器的交互：cookies

四个组件：

1) HTTP**响应消息**中的一个**cookie首部行**

2) 下一个HTTP**请求消息**中的一个**cookie首部行**

3) 保存在用户**主机上的cookie文件**，由用户的**浏览器**管理

4) Web站点的后台**数据库**

应用场景：认证，购物车，推荐，用户会话状态

### 2.5 web 缓存(代理服务器)

目标: 不需要原始服务器就可以满足用户需求。

如果请求对象存在于缓存服务器：缓存服务器直接返回对象给客户。
如果请求对象不在缓存服务器中：缓存服务器向原始服务器请求，然后返回对象给客户。

代理服务器同时扮演客户端和服务端。

作用：**减少**对于客户端请求的**响应时间**。**减少**原始服务器接入链路的**流量**。

### 2.6 条件GET

条件GET：允许缓存服务器证实它的**对象是最新的**

具体方法:

• (C)发送包含上次更新的时间

• (S)如果没有发生修改(比对接收的和本地的上次更新时间是否相同)，则返回一个空数据的响应报文（304 Not Modified）

• (S)如果发生了修改，则返回一个最新的数据

## FTP: 文件传输协议(21/20)（不要求）

FTP 服务器：端口号(21/20)

## 3 因特网中的电子邮件

 <img src="\Snipaste_2024-06-11_16-01-37.png" style="zoom:60%;" /> 

### 3.1 SMTP(使用TCP,port:25)

**<u>*服务器间使用，代理发邮件使用*</u>**

<img src="\Snipaste_2024-06-11_15-49-31.png" style="zoom:60%;" /> <img src="\Snipaste_2024-06-11_17-42-01.png" style="zoom:60%;" /> 

 HTTP: pull（拉模式）

 SMTP: push（推模式）

HTTP: **一个对象**对应**一个报文**
SMTP: **多个对象**封装在**一个报文**中

#### MIME（属于SMTP）

对于非ASCII字符文本，为了能够使用SMTP进行传输，引入了MIME协议

### 3.2 POP3(使用TCP,port:110)/IMAP

**<u>*代理收邮件使用*</u>**

简单、功能有限：在用户代理打开了一个到邮件服务器(服务器)端口110上的TCP连接后，开始工作。

### 3.3 HTTP

**<u>*代理收、发邮件使用*</u>**

## 4 DNS：因特网的目录服务(使用UDP,port:53)

### 4.1 DNS提供的服务

#### DNS作用

 **主机名到IP地址的转换**

 主机**别名**查询 

 **负载均衡** 

#### 为什么不使用单一的DNS服务器

 单一点失效

 流量负担

 远程的集中式数据库

 维护开销大

### 4.2 分布式、层次数据库

 **根服务器**：有13个，维护**顶级域名服务器**的**IP地址**
 **顶级域服务器**（TLD）：维护**顶级域名**的**IP地址**。顶级域名：com、org、net、edu、gov、jp、ca、cn
 **权威DNS服务器**：由组织机构维护的自己提供的服务器的域名到IP地址映射的DNS服务器。(每个学校，企业)
• 本地DNS服务器(默认DNS服务器)： 

### 4.3 DNS域名解析过程

#### 1.迭代查询

本地DNS服务器代表查询主机发送查询请求。

<img src="\Snipaste_2024-06-11_16-27-01.png" style="zoom:60%;" /> 

#### 2.递归查询

以DNS客户端自己的名义发出查询请求，来获得IP地址映射信息。

<img src="\Snipaste_2024-06-11_16-27-24.png" style="zoom:60%;" /> 

### 4.4 DNS 缓存

当某DNS服务器接收一个DNS回答时，它能将映射**缓存在本地存储器**中。

 **当TTL时间超时**，缓存的映射条目会**超时删除**（通常为2天）
 **顶级域服务器**(TLD)通常**会被本地**域名服务器**缓存**
• 从而**<u>*减少根域名服务器被访问的次数*</u>**

### 4.5 DNS记录和报文

#### 1.资源记录(RR)

RR format: (name, value, type, TTL(生存时间))

1)type=A（主机名/IP地址）

（**主机名**，**IP地址**，A）

 例子：(www.uestc.edu.cn, 1.2.3.4, A)

2)type=NS(域名/IP地址)

（**域名**，**DNS服务器名**，NS）

 例子：(uestc.edu.cn, dns.uestc.edu.cn, NS)

3)type=CNAME (别名/规范名)

（别名，规范名，CNAME）

4)type=MX(别名/规范名)邮件服务器

（邮件服务器名，规范名，MX）

<img src="\Snipaste_2024-06-11_16-21-25.png" style="zoom:80%;" /> 

<img src="\Snipaste_2024-06-11_16-55-50.png" style="zoom:80%;" /> 

#### 2.插入记录到DNS

<img src="\Snipaste_2024-06-11_17-01-47.png" style="zoom:80%;" /> 

TLD：**DNS服务器**的**A记录**，**主机到DNS服务器**的映射**NS记录**。

权威：**主机**的**A记录**。

#### 3.报文（不考）

## 5 P2P文件分发（不考）

## 6 视频流和内容分发网（CDN）

### 6.1 HTTP流和DASH

1.**HTTP流**：用户通过请求视频URL对应文件，服务器发送这个文件，客户**将收到的视频数据在应用缓存中缓存，如果缓存的数据量达到阈值，播放器就可以开始播放。**

优点：用户可以在**接收数据的同时播放视频**，不用等到所有数据完全接收

缺点：用户收到的视频流是**相同的编码速率**，不能根据用户的带宽差异，给出不同的视频编码速率选择(质量)

2.**DASH**：将视频文件分为**多个块**，每个区块都以不同的速率存储、编码

服务器**告示文件**：为不同的块提供URL

客户端根据当前的可用带宽智能决策

### 6.2 内容分发网络（CDN）

将**视频的多份拷贝**存储在地理上**分散的不同站点**来提供服务，将每个用户请求定位到能为用户提供最好服务的位置

#### 1.服务器放置原则

1）**深入**：目标是**靠近终端用户**，通过减少终端用户与CDN集群之间链路和路由器的数量，从而改善用户感受(减小时延，提升吞吐量)。

**高度分布式**设计，维护和管理集群困难。

2）**邀请做客**：在少量**关键位置**(例如IXP)，建造大集群，邀请到ISP做客。

只产生较低的维护和管理开销。

## 7 套接字编程：生成网络应用

socket: 位于应用进程和端到端传输协议之间的门

### 7.1 UDP套接字编程

UDP: 在客户端和服务器之间不建立连接

 发送数据前**不“握手”**

 **发送方**明确地**粘贴IP目的地址和目的端口号给每个发送的分组**

 **接收方**从收到的分组中**抽取发送方IP地址**

<img src="\Snipaste_2024-06-11_18-08-33.png" style="zoom:60%;" /> 

### 7.2 TCP套接字编程

客户端必须联系服务器

 服务器进程**必须首先运行**

 服务器必须**创建套接字**(socket)**用于**欢迎客户端进程的联系(**侦听**套接字)

 当收到客户端进程的联系，服务器TCP为服务器进程**创建新的套接字**，经过“三次握手” ，建立一个TCP连接

客户端进程联系服务器：

 **创建TCP套接字**，**指定服务器的IP地址和端口号**

<img src="\Snipaste_2024-06-11_18-16-13.png" style="zoom:80%;" /> 

# 第3章 运输层









































# 第4\5章 网络层和选路 

# 第6章 链路层和局域网